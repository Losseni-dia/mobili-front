<div class="login-wrapper">
    <div class="login-card">
        <div class="login-header">
            <h2>Cr√©er un compte</h2>
            <p>Rejoignez la communaut√© Mobili</p>
        </div>

        <form (submit)="onRegister()" #regForm="ngForm">
            <div class="form-group avatar-selection">
                <label>Photo de profil</label>
                <div class="avatar-container">
                    <div class="preview-circle" appImagePan (positionChange)="updatePosition($event)">
                        @if (imagePreview()) {
                        <img [src]="imagePreview()" [style.transform]="'scale(' + imageZoom() + ')'"
                            [style.object-position]="imgPos().x + '% ' + imgPos().y + '%'" draggable="false"
                            style="transition: none;" alt="Aper√ßu">
                        } @else {
                        <div class="initials-placeholder">
                            {{ getInitials() }}
                        </div>
                        }
                    </div>

                    @if (imagePreview()) {
                    <div class="zoom-control">
                        <label>Ajuster le zoom</label>
                        <input type="range" min="1" max="3" step="0.1" [value]="imageZoom()"
                            (input)="onZoomChange($event)">
                    </div>
                    }

                    <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" hidden>
                    <button type="button" class="btn-upload" (click)="fileInput.click()">
                        {{ selectedFile ? 'Changer la photo' : 'Choisir une photo' }}
                    </button>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Pr√©nom</label>
                    <input type="text" name="firstName" [(ngModel)]="user.firstname" required placeholder="Jean">
                </div>
                <div class="form-group">
                    <label>Nom</label>
                    <input type="text" name="lastName" [(ngModel)]="user.lastname" required placeholder="Dia">
                </div>
            </div>

            <div class="form-group">
                <label>Nom d'utilisateur</label>
                <input type="text" name="login" [(ngModel)]="user.login" required minlength="3" placeholder="dia">
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" [(ngModel)]="user.email" required email placeholder="exemple@mail.com">
            </div>

            <div class="form-group">
                <label>Mot de passe</label>
                <div class="input-wrapper">
                    <input [type]="showPassword() ? 'text' : 'password'" name="password" [(ngModel)]="user.password"
                        required minlength="6">
                    <button type="button" class="eye-icon" (click)="togglePassword()">
                        {{ showPassword() ? 'üôà' : 'üëÅÔ∏è' }}
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label>Confirmer</label>
                <div class="input-wrapper">
                    <input [type]="showConfirmPassword() ? 'text' : 'password'" name="confirmPassword"
                        [(ngModel)]="user.confirmPassword" (blur)="isConfirmTouched = true" required>
                    <button type="button" class="eye-icon" (click)="toggleConfirmPassword()">
                        {{ showConfirmPassword() ? 'üôà' : 'üëÅÔ∏è' }}
                    </button>
                </div>
                @if (isConfirmTouched && !passwordsMatch()) {
                <small class="text-error">Les mots de passe ne correspondent pas.</small>
                }
            </div>

            @if (errorMessage()) {
            <div class="error-banner">{{ errorMessage() }}</div>
            }

            <button type="submit" class="btn-submit" [disabled]="regForm.invalid || !passwordsMatch() || isLoading()">
                <span *ngIf="!isLoading()">S'inscrire</span>
                <span *ngIf="isLoading()" class="loader"></span>
            </button>
        </form>

        <div class="login-footer">
            <span>D√©j√† un compte ? </span>
            <a routerLink="/auth/login">Connectez-vous</a>
        </div>
    </div>
</div>