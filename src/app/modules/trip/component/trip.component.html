<div class="trip-module">
    <div class="search-bar">
        <div class="input-group">
            <label>D√©part</label>
            <input [(ngModel)]="departure" name="departure" placeholder="D'o√π partez-vous ?">
        </div>

        <div class="input-group">
            <label>Arriv√©e</label>
            <input [(ngModel)]="arrival" name="arrival" placeholder="O√π allez-vous ?">
        </div>

        <div class="input-group">
            <label>Date</label>
            <input type="date" [(ngModel)]="travelDate" name="travelDate">
        </div>

        <button (click)="find()" [disabled]="loading">
            <span *ngIf="!loading">RECHERCHER</span>
            <span *ngIf="loading">...</span>
        </button>
    </div>

    <div *ngIf="loading" class="loader">
        <div class="spinner"></div>
        <p>Recherche des meilleurs trajets...</p>
    </div>

    <div class="results" *ngIf="!loading && results && results.length > 0">
        <div class="card" *ngFor="let t of results">
            <div class="card-header">
                <div class="company">
                    <div class="logo-circle" *ngIf="!t.companyLogo">
                        {{ t.companyName?.charAt(0) || 'M' }}
                    </div>
                    <img *ngIf="t.companyLogo" [src]="t.companyLogo" class="logo" alt="Logo">
                    <span class="name">{{ t.companyName || 'Agence Mobili' }}</span>
                </div>
                <span class="v-type">{{ t.vehicleType || 'Standard' }}</span>
            </div>

            <div class="card-body">
                <div class="info-group">
                    <div class="time-container">
                        <span class="time">{{ t.departureDateTime | date:'HH:mm' }}</span>
                    </div>

                    <strong class="route">
                        {{ t.departureCityName }} <span class="arrow">‚ûî</span> {{ t.arrivalCityName }}
                    </strong>

                    <span class="full-date">{{ t.departureDateTime | date:'dd MMM yyyy' }}</span>
                </div>

                <div class="price-group">
                    <span class="price">{{ t.price | number }}</span>
                    <small>CFA</small>
                </div>
            </div>

            <div class="card-footer">
                <div class="meta-info">
                    <span class="seats" [class.urgent]="t.availableSeats < 5">
                        {{ t.availableSeats }} places disponibles
                    </span>

                    <span class="status-badge" [attr.data-status]="t.status">
                        {{
                        t.status === 'SCHEDULED' ? 'Programm√©' :
                        t.status === 'ON_GOING' ? 'En cours' :
                        t.status === 'COMPLETED' ? 'Termin√©' :
                        t.status === 'CANCELLED' ? 'Annul√©' : t.status
                        }}
                    </span>
                </div>

                <button class="btn-book" [disabled]="t.status !== 'SCHEDULED' || t.availableSeats === 0">
                    {{ t.availableSeats > 0 ? 'R√©server' : 'Complet' }}
                </button>
            </div>
        </div>
    </div>

    <div class="no-results" *ngIf="!loading && hasSearched && results?.length === 0">
        <div class="icon">üîç</div>
        <p>D√©sol√©, aucun trajet ne correspond √† votre recherche.</p>
    </div>
</div>